load("//rules:skytest_test.bzl", "skytest_test")
load("@rules_cc//cc:defs.bzl", "cc_binary", "cc_library")

skytest_test(
    name = "pass_test",
    srcs = ["pass_test.cpp"],
    stdout = [
        "expect true.*PASS",
        "all tests passed",
    ],
)

skytest_test(
    name = "multiple_pass_test",
    srcs = ["multiple_pass_test.cpp"],
    stdout = [
        "expect true 1.*PASS",
        "expect true 2.*PASS",
        "all tests passed.*2 tests",
    ],
)

skytest_test(
    name = "fail_test",
    srcs = ["fail_test.cpp"],
    return_code = 1,
    stdout = [
        "expect true.*FAIL",
        "1 test failed",
    ],
)

skytest_test(
    name = "source_location_test",
    srcs = ["source_location_test.cpp"],
    return_code = 1,
    stdout = [
        "expect true.*FAIL.*source_location_test.cpp:8",
    ],
)

cc_library(
    name = "no_malloc",
    srcs = ["no_malloc.cpp"],
)

cc_binary(
    name = "null_printer",
    srcs = ["null_printer.cpp"],
    malloc = ":no_malloc",
    deps = ["//:skytest"],
)

skytest_test(
    name = "null_printer_test",
    binary = ":null_printer",
)
